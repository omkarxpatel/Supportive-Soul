Modified because I was asked to fix this garbage code.
